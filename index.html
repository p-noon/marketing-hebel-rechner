<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Szenario-Simulator â€“ CR & Kassenzettel</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial,sans-serif;background:#f4f4f6;padding:20px}
  .simulator{max-width:950px;margin:40px auto;background:#fff;border-radius:24px;box-shadow:0 8px 20px rgba(0,0,0,0.08);padding:28px;color:#111}
  h1{text-align:center;font-size:1.7rem;margin:0 0 6px}
  .subtitle{text-align:center;color:#666;margin-bottom:22px}
  .input-grid{display:flex;gap:24px;flex-wrap:wrap}
  .column{flex:1;min-width:280px}
  label{display:block;margin-top:12px;margin-bottom:6px;color:#444;font-size:0.95rem}
  input[type="number"],input[readonly]{width:100%;padding:10px;border-radius:10px;border:1px solid #d2d2d7;background:#f9f9f9;box-sizing:border-box;font-size:1rem}
  input[readonly]{background:#f0f0f0}
  .button-main{margin-top:22px;width:100%;background:#0071e3;color:#fff;border:none;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
  .button-main:hover{background:#0a84ff}
  .results{margin-top:26px;display:none}
  .result-grid{display:grid;gap:14px}
  .result-card{background:#f6f7fb;padding:14px;border-radius:12px;text-align:center}
  .result-card h2{margin:8px 0;font-size:1.6rem;color:#0071e3}
  .result-card.alt h2{color:#333}
  .helper{font-size:0.88rem;color:#666;margin-top:8px}
  .delta{font-size:0.85rem;margin-top:4px}
  .delta.positive{color:#0a8f00}
  .delta.negative{color:#d70015}
  .slider-section{margin-top:28px;padding-top:18px;border-top:1px solid #e6e6ee;display:none}
  .slider-wrapper{position:relative;margin-top:40px;margin-bottom:40px;text-align:center}
  .slider-label-inline{font-weight:600;color:#0071e3;font-size:1rem}
  .slider-value{display:inline-block;margin-left:6px;font-weight:700;color:#0071e3;white-space:nowrap}
  input[type="range"]{width:100%;accent-color:#0071e3;cursor:pointer;margin-top:8px}
  footer{margin-top:20px;text-align:center;color:#999;font-size:13px}
  footer a{color:#0071e3;text-decoration:none}
</style>
</head>
<body>

<div class="simulator">
  <h1>Szenario-Simulator</h1>
  <p class="subtitle">Simuliere, wie sich Ã„nderungen bei Kassenzettel und Conversion Rate auf Umsatz, Gewinn & ROAS auswirken.</p>

  <div class="input-grid">
    <div class="column">
      <h3>Grunddaten</h3>
      <label>Bruttoumsatz pro Bestellung (EUR)</label>
      <input id="revenueGross" type="number" step="0.01" placeholder="z. B. 60">
      <label>Nettoumsatz (automatisch)</label>
      <input id="revenueNet" readonly>
      <label>Herstellungskosten pro Bestellung (EUR)</label>
      <input id="productionCost" type="number" step="0.01" placeholder="z. B. 20">
      <label>Verpackung & Versand (EUR)</label>
      <input id="shippingCost" type="number" step="0.01" placeholder="z. B. 5">
    </div>

    <div class="column">
      <h3>Kampagnendaten</h3>
      <label>Conversion Rate (%)</label>
      <input id="conversionRate" type="number" step="0.01" placeholder="z. B. 2">
      <label>ROAS</label>
      <input id="roas" type="number" step="0.1" placeholder="z. B. 3">
      <label>Marketingbudget (EUR)</label>
      <input id="budget" type="number" step="1" placeholder="z. B. 1000">
      <label>Sonstige Fixkosten (EUR)</label>
      <input id="fixedCosts" type="number" step="1" placeholder="z. B. 0">
    </div>
  </div>

  <button class="button-main" id="calcButton">Berechnen (Ist)</button>

  <div class="results" id="results">
    <!-- Ist-Ergebnisse -->
    <div class="result-grid" style="grid-template-columns:1fr 1fr; gap:14px; margin-top:16px;">
      <div class="result-card">
        <p>Umsatz (Brutto)</p>
        <h2 id="totalRevenue">â€“</h2>
        <div class="helper" id="visitorsDisplay"></div>
      </div>
      <div class="result-card alt">
        <p>Gewinn (Ist)</p>
        <h2 id="totalProfit">â€“</h2>
      </div>
    </div>

    <div class="slider-section" id="scenarioSection">
      <h3>Szenario anpassen</h3>

      <!-- Kassenzettel -->
      <div class="slider-wrapper">
        <span class="slider-label-inline">Neuer Kassenzettel:</span>
        <span id="receiptValue" class="slider-value"></span>
        <input id="sliderReceipt" type="range" min="0" max="200" step="0.1">
      </div>

      <!-- Conversion Rate -->
      <div class="slider-wrapper">
        <span class="slider-label-inline">Neue CR:</span>
        <span id="crValue" class="slider-value"></span>
        <input id="sliderCr" type="range" min="0" max="10" step="0.01">
      </div>

      <!-- Neue Werte -->
      <div class="result-grid" style="grid-template-columns:1fr 1fr 1fr; gap:14px; margin-top:20px;">
        <div class="result-card">
          <p>Neuer Umsatz (Brutto)</p>
          <h2 id="newRevenue">â€“</h2>
          <div id="deltaRevenue" class="delta"></div>
        </div>
        <div class="result-card alt">
          <p>Neuer Gewinn</p>
          <h2 id="newProfit">â€“</h2>
          <div id="deltaProfit" class="delta"></div>
        </div>
        <div class="result-card">
          <p>Neuer ROAS</p>
          <h2 id="newRoas">â€“</h2>
          <div id="deltaRoas" class="delta"></div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <a href="#" id="embedLink"><strong>ðŸ”— Rechner einbetten / teilen</strong></a> â€“ entwickelt von 
    <a href="https://www.purple-noon.de" target="_blank">Purple Noon</a>
  </footer>
</div>

<script>
function fmt(num){return isFinite(num)?num.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}):"â€“";}
function updateNet(){const gross=+document.getElementById("revenueGross").value||0;document.getElementById("revenueNet").value=gross?fmt(gross/1.19)+" â‚¬":"";}

let base=null;

function resetScenario(){
  document.getElementById("results").style.display="none";
  document.getElementById("scenarioSection").style.display="none";
  base=null;
}

function calcBase(){
  const gross=+document.getElementById("revenueGross").value||0;
  const net=gross/1.19;
  const prod=+document.getElementById("productionCost").value||0;
  const ship=+document.getElementById("shippingCost").value||0;
  const crPct=+document.getElementById("conversionRate").value||0;
  const cr=crPct/100;
  const roas=+document.getElementById("roas").value||0;
  const budget=+document.getElementById("budget").value||0;
  const fixed=+document.getElementById("fixedCosts").value||0;

  if(!gross||!roas||!budget){alert("Bitte mindestens Kassenzettel, ROAS und Budget eingeben.");return;}

  const totalRevenue=budget*roas;
  const orders=gross?totalRevenue/gross:0;
  const visitors=cr>0?orders/cr:0;
  const profitPerOrder=net-prod-ship;
  const totalProfit=orders*profitPerOrder-budget-fixed;

  base={gross,net,prod,ship,cr,crPct,roas,budget,fixed,totalRevenue,orders,visitors,profitPerOrder,totalProfit};

  document.getElementById("totalRevenue").textContent=fmt(totalRevenue)+" â‚¬";
  document.getElementById("totalProfit").textContent=fmt(totalProfit)+" â‚¬";
  document.getElementById("visitorsDisplay").textContent="Berechnete Besucher: "+fmt(visitors);

  document.getElementById("results").style.display="block";
  document.getElementById("scenarioSection").style.display="block";

  const rec=document.getElementById("sliderReceipt");
  const crs=document.getElementById("sliderCr");
  rec.min=gross*0.5;rec.max=gross*1.5;rec.value=gross;rec.dataset.center=gross;
  crs.min=Math.max(0,crPct*0.5);crs.max=crPct*1.5;crs.value=crPct;crs.dataset.center=crPct;

  document.getElementById("receiptValue").textContent=fmt(gross);
  document.getElementById("crValue").textContent=fmt(crPct);

  updateScenario();
}

function updateScenario(){
  if(!base)return;
  const recSlider=document.getElementById("sliderReceipt");
  const crSlider=document.getElementById("sliderCr");
  const newGross=+recSlider.value||0;
  const newCrPct=+crSlider.value||0;
  const newCr=newCrPct/100;

  document.getElementById("receiptValue").textContent=fmt(newGross);
  document.getElementById("crValue").textContent=fmt(newCrPct);

  const newProd=base.prod*(newGross/(base.gross||1));
  const vis=base.visitors;
  const newOrders=vis*newCr;
  const newRevenue=newOrders*newGross;
  const newNet=newGross/1.19;
  const profitPer=newNet-newProd-base.ship;
  const newProfit=newOrders*profitPer-base.budget-base.fixed;
  const newRoas=base.budget>0?newRevenue/base.budget:0;

  document.getElementById("newRevenue").textContent=fmt(newRevenue)+" â‚¬";
  document.getElementById("newProfit").textContent=fmt(newProfit)+" â‚¬";
  document.getElementById("newRoas").textContent=fmt(newRoas);

  const deltaRev=document.getElementById("deltaRevenue");
  const deltaProf=document.getElementById("deltaProfit");
  const deltaRoas=document.getElementById("deltaRoas");

  deltaRev.textContent=(newRevenue-base.totalRevenue>=0?"+":"")+fmt(newRevenue-base.totalRevenue)+" â‚¬";
  deltaProf.textContent=(newProfit-base.totalProfit>=0?"+":"")+fmt(newProfit-base.totalProfit)+" â‚¬";
  deltaRoas.textContent=(newRoas-base.roas>=0?"+":"")+fmt(newRoas-base.roas);

  deltaRev.className="delta "+(newRevenue-base.totalRevenue>=0?"positive":"negative");
  deltaProf.className="delta "+(newProfit-base.totalProfit>=0?"positive":"negative");
  deltaRoas.className="delta "+(newRoas-base.roas>=0?"positive":"negative");

  document.getElementById("newProfit").style.color=newProfit<0?"#d70015":"#0071e3";
}

// Event Listener
document.getElementById("calcButton").addEventListener("click",calcBase);
document.getElementById("sliderReceipt").addEventListener("input",updateScenario);
document.getElementById("sliderCr").addEventListener("input",updateScenario);

// Doppelklick auf Slider = Reset auf Mitte
document.querySelectorAll('input[type="range"]').forEach(slider=>{
  slider.addEventListener("dblclick",()=>{
    if(slider.dataset.center){
      slider.value=slider.dataset.center;
      updateScenario();
    }
  });
});

// Eingaben setzen Szenario zurÃ¼ck
document.querySelectorAll('#revenueGross,#productionCost,#shippingCost,#conversionRate,#roas,#budget,#fixedCosts')
  .forEach(el=>el.addEventListener('input',resetScenario));

document.getElementById("revenueGross").addEventListener("input",updateNet);

// Embed Overlay
document.getElementById("embedLink").addEventListener("click",e=>{e.preventDefault();alert('Embed-Code wie zuvor: <iframe src="https://p-noon.github.io/scenario-simulator" width="100%" height="950" style="border:none;"></iframe>')});
</script>
</body>
</html>
